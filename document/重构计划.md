# 编辑器重构计划

## 1. 问题分析

当前编辑器存在以下主要问题:

1. 组件系统不完整
   - 缺少完整的组件类型定义
   - 组件属性配置不统一
   - 组件渲染逻辑分散

2. 拖拽功能不可用
   - DragDropContext 配置不完整
   - 拖拽源和目标区域定义不清晰
   - 缺少拖拽状态管理

3. 属性面板功能受限
   - 属性配置项不完整
   - 缺少实时预览
   - 样式和数据属性混合

## 2. 重构目标

1. 完善组件系统
   - 统一组件类型定义
   - 标准化组件属性结构
   - 实现组件注册机制

2. 优化拖拽交互
   - 完善拖拽上下文
   - 规范化拖拽区域
   - 增强拖拽体验

3. 增强属性编辑
   - 完善属性配置面板
   - 支持实时预览
   - 分离样式和数据配置

## 3. 重构步骤

### 3.1 类型定义重构

1. 在 `src/types/component.ts` 中完善类型定义:

```typescript
// 组件类型枚举
export enum ComponentType {
  TEXT = 'text',
  IMAGE = 'image',
  BUTTON = 'button',
  CONTAINER = 'container'
}

// 组件样式接口
export interface ComponentStyle {
  width?: string | number;
  height?: string | number;
  margin?: string | number;
  padding?: string | number;
  color?: string;
  backgroundColor?: string;
  fontSize?: string | number;
  fontWeight?: string | number;
  textAlign?: 'left' | 'center' | 'right';
  // ... 其他样式属性
}

// 组件数据接口
export interface ComponentData {
  text?: string;
  src?: string;
  alt?: string;
  href?: string;
  target?: string;
  // ... 其他数据属性
}

// 组件接口
export interface Component {
  id: string;
  type: ComponentType;
  props: {
    style: ComponentStyle;
    data: ComponentData;
  };
  children?: Component[];
}
```

### 3.2 组件系统重构

1. 重构组件注册配置 (`src/config/components.ts`):

```typescript
export const componentDefinitions = {
  [ComponentType.TEXT]: {
    type: ComponentType.TEXT,
    label: '文本',
    defaultProps: {
      style: {
        width: '100%',
        color: '#333333',
        fontSize: 14
      },
      data: {
        text: '示例文本'
      }
    }
  },
  // ... 其他组件定义
};
```

2. 统一组件实现接口

### 3.3 拖拽功能重构

1. 重构 Canvas 组件
2. 优化 DraggableWrapper 组件
3. 完善拖拽状态管理

### 3.4 属性面板重构

1. 分离样式和数据配置
2. 实现属性组件映射
3. 添加实时预览支持

## 4. 实施计划

### 第一阶段: 基础架构 (2天)
- 完善类型定义
- 重构组件注册系统
- 实现基础布局

### 第二阶段: 组件系统 (3天)
- 实现核心组件
- 统一组件接口
- 完善组件渲染

### 第三阶段: 拖拽功能 (2天)
- 实现拖拽源
- 实现拖拽目标
- 优化拖拽体验

### 第四阶段: 属性编辑 (3天)
- 实现属性面板
- 添加实时预览
- 优化编辑体验

## 5. 注意事项

1. 代码规范
   - 使用 TypeScript 严格模式
   - 遵循 React 最佳实践
   - 保持代码简洁清晰

2. 性能优化
   - 合理使用 React.memo
   - 优化重渲染
   - 延迟加载非核心功能

3. 可扩展性
   - 预留扩展接口
   - 保持组件独立性
   - 支持自定义配置

## 6. 后续规划

1. 高级特性
   - 组件模板
   - 撤销/重做
   - 快捷键支持

2. 优化改进
   - 主题定制
   - 响应式支持
   - 动画效果

3. 工具支持
   - 预览模式
   - 代码导出
   - 页面管理

这份重构计划基于现有代码进行分析和规划,通过分步骤实施可以逐步完善编辑器功能。建议先完成基础架构和组件系统的重构,为后续功能开发打好基础。 